"use strict";(self.webpackChunkhalo_documentation=self.webpackChunkhalo_documentation||[]).push([[2520],{28453:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>o});var n=i(96540);const s={},r=n.createContext(s);function a(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),n.createElement(r.Provider,{value:t},e.children)}},82164:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>l,frontMatter:()=>a,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"documentations/security-guidance/security-architecture","title":"Security Architecture","description":"Introduction","source":"@site/docs/documentations/security-guidance/01 - security-architecture.md","sourceDirName":"documentations/security-guidance","slug":"/documentations/security-guidance/security-architecture","permalink":"/docs/documentations/security-guidance/security-architecture","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":1,"frontMatter":{},"sidebar":"documentationSidebar","previous":{"title":"Security Guidance","permalink":"/docs/documentations/security-guidance/"},"next":{"title":"Key Management","permalink":"/docs/documentations/security-guidance/key-management"}}');var s=i(74848),r=i(28453);const a={},o="Security Architecture",c={},d=[{value:"Introduction <a></a>",id:"introduction-",level:3},{value:"Sensitive Assets <a></a>",id:"sensitive-assets-",level:3},{value:"Protection mechanisms <a></a>",id:"protection-mechanisms-",level:3},{value:"Permissions required <a></a>",id:"permissions-required-",level:3}];function h(e){const t={a:"a",br:"br",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"security-architecture",children:"Security Architecture"})}),"\n",(0,s.jsxs)(t.h3,{id:"introduction-",children:["Introduction ",(0,s.jsx)("a",{href:"#introduction",id:"introduction"})]}),"\n",(0,s.jsx)(t.p,{children:"The Halo Dot SDK provides a simple interface for integrators to start accepting contactlesss payments in their applications. However, processing card data brings with it a host of security concerns. This document will describe the sensitive assets that cross the boundary from the SDK to the application (and vice versa) to help explain what is required from an application perspective. Additionally, this document will describe the various security mechanisms that are used and how these interact with the integrating application. Finally, this document will list the permissions required by the SDK and provide explanations for why they are necessary."}),"\n",(0,s.jsxs)(t.h3,{id:"sensitive-assets-",children:["Sensitive Assets ",(0,s.jsx)("a",{href:"#sensitive-assets",id:"sensitive-assets"})]}),"\n",(0,s.jsx)(t.p,{children:"This section describes the sensitive assets that cross the boundary of the SDK. This refers to any pieces of information that are either directly or indirectly used in the processing of financial data. This includes authentication tokens, certificates and keys and card data. In the table below, the direction column refers to the direction that the assets flow. There are 3 entities mentioned:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Application"}),": This is the integrating application that is calling methods in the Halo Dot SDK."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"SDK"}),": This is the Halo Dot SDK"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Backend"}),": This is the Halo Dot transactional server"]}),"\n"]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Asset"}),(0,s.jsx)(t.th,{children:"Direction"}),(0,s.jsx)(t.th,{children:"Explanation"}),(0,s.jsx)(t.th,{children:"Required Protection"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"JWT"}),(0,s.jsx)(t.td,{children:"Application \u2192 SDK"}),(0,s.jsx)(t.td,{children:"The JWT is required by all SDK functions, and must be provided by the integrating application"}),(0,s.jsxs)(t.td,{children:["This is documented in the ",(0,s.jsx)(t.a,{href:"/docs/documentations/security-guidance/key-management",children:"key management"})," document"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Phone keys"}),(0,s.jsx)(t.td,{children:"SDK \u2192 Backend"}),(0,s.jsx)(t.td,{children:"The SDK performs a key exchange with the Halo Dot servers to establish shared keys that can be used for encryption and signing of messages at application level"}),(0,s.jsx)(t.td,{children:"None; this is protected by Halo Dot"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Server keys"}),(0,s.jsx)(t.td,{children:"Backend \u2192 SDK"}),(0,s.jsx)(t.td,{children:"The Halo Dot servers respond with server keys that are used for encrypting and signing messages. A cache of keys is stored on the device, protected by the Halo Dot SDK"}),(0,s.jsx)(t.td,{children:"None; this is protected by Halo Dot"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Terminal config"}),(0,s.jsx)(t.td,{children:"Backend \u2192 SDK"}),(0,s.jsx)(t.td,{children:"The Halo Dot servers respond with the terminal config to intialise the terminal. This determines what card types are supported, what the CVM limits are, whether ot not PIN is supportedf and any other terminal configuration properties"}),(0,s.jsx)(t.td,{children:"None; this is protected by Halo Dot"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"IPEK"}),(0,s.jsx)(t.td,{children:"Backend \u2192 SDK"}),(0,s.jsx)(t.td,{children:"The Initial Pin Encryption Key is generated by an HSM and is used to initialise the DUKPT state on the device. This is required to process PIN transactions securely."}),(0,s.jsx)(t.td,{children:"None; this is protected by Halo Dot"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Entropy"}),(0,s.jsx)(t.td,{children:"Backend \u2192 SDK"}),(0,s.jsx)(t.td,{children:"Entropy is sourced from the Halo Dot servers to seed the DRNG on the phone"}),(0,s.jsx)(t.td,{children:"None; this is protected by Halo Dot"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Transaction Data"}),(0,s.jsx)(t.td,{children:"SDK \u2192 Backend"}),(0,s.jsx)(t.td,{children:"This is the card data that is required to authorise the transaction."}),(0,s.jsx)(t.td,{children:"None; this is protected by Halo Dot"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Encrypted PIN Block"}),(0,s.jsx)(t.td,{children:"SDK \u2192 Backend"}),(0,s.jsx)(t.td,{children:"The client PIN that is captured if required. Encrypted using DUKPT and signed by the SDK, validated on the backend"}),(0,s.jsx)(t.td,{children:"None; this is protected by Halo Dot"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Transaction Result"}),(0,s.jsx)(t.td,{children:"SDK \u2192 Application"}),(0,s.jsx)(t.td,{children:"The result of the transaction is returned to the integrating application. This includes the transaction disposition, masked PAN and transaction IDs."}),(0,s.jsx)(t.td,{children:"The transaction result is returned with a signature - the signing key will be shared out of band. Please verify the signature to ensure that the result has not been tampered with."})]})]})]}),"\n",(0,s.jsxs)(t.h3,{id:"protection-mechanisms-",children:["Protection mechanisms ",(0,s.jsx)("a",{href:"#protection-mechanisms",id:"protection-mechanisms"})]}),"\n",(0,s.jsxs)(t.p,{children:["To protected the integrity of the application and ensure that financial data is securely read and transmitted, the Halo Dot SDK makes use of a number of protection mechanisms. These range from static protections (to protect against reverse engineering and code analysis) to run-time protection (to protect against instrumentation and malicious access). Any errors that occur as a result of these mechanisms are reported either the ",(0,s.jsx)(t.code,{children:"HaloStartTransactionResult"}),", ",(0,s.jsx)(t.code,{children:"HaloTransactionResult"})," and",(0,s.jsx)(t.code,{children:"HaloInitializationResult"})," objects."]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Static code protection (obfuscation)"}),(0,s.jsx)(t.br,{}),"\n","The SDK is minified using R8 and then obfuscated using Zimperium zShield. The Kotlin code is transpiled to C++ and then obfuscated to prevent static code analysis. There is no requirement from the integrating app to handle this, but be aware that debugging the Halo Dot source code will not produce usable source files for internal functions."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Run time integrity protections"}),(0,s.jsx)(t.br,{}),"\n","The SDK performs various checks at run time to ensure the integrity of the platform. This includes checking if the device is rooted, if a debugger is attached or if an instrumentation framework is being used. If any of these are detected, the application immediately terminates.","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Root checks",(0,s.jsx)(t.br,{}),"\n","Rooted devices have full access to the memory and services running on them, and so they cannot be trusted to perform financial transactions."]}),"\n",(0,s.jsxs)(t.li,{children:["Instrumentation checks",(0,s.jsx)(t.br,{}),"\n","Instrumentation frameworks (such as Frida) are used to manipulate running applications by hooking into function calls and replcaing their implementations. This allows the user to potentially bypass security checks, exfiltrate card data or make the app think that a transaction has been approved when it has actually been declined, or vice versa."]}),"\n",(0,s.jsxs)(t.li,{children:["Debugger checks",(0,s.jsx)(t.br,{}),"\n","Debuggers can be used to inspect memory and alter application flows, and so they can not be allowed on a running payment application. With Android, it is possible to debug a device remotely, and so we must terminate the application if we detect the presence of a debugger."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Developer option checks"}),(0,s.jsx)(t.br,{}),"\n","If developer options are enabled, it is possible to attach ",(0,s.jsx)(t.code,{children:"adb"})," to the device, which can be used to extract information or view the screen remotely (since ",(0,s.jsx)(t.code,{children:"adb"})," can be attached over wi-fi). Thus, the SDK does not allow developer options to be enabled on the release build. The debug build allows developer options as normal."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Accessibility service checks"}),(0,s.jsx)(t.br,{}),"\n","Accessibility services are capable of scraping screen elements and processing them to enable screen reading or other accessibility functions. Unfortunately, this presents a security vulnerability for the PIN screen, as a malicious accessibility service would be capable of capturing PIN numbers. Thus, the release Halo Dot SDK does not allow the PIN screen to be displayed if accessibility services are enabled. A warning will be returned during initialisation if accessibility services are detected, and an error will be returned during transaction processing if a PIN is required."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Overlay detection"}),(0,s.jsx)(t.br,{}),"\n","The SDK does not allow overlays to be displayed over the PIN screen. This is to prevent a class of attack where transparent overlays can capture PIN numbers without the user's notice."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Attestation"}),(0,s.jsx)(t.br,{}),"\n","Attestation is the process of verifying the claims that the device makes about itself. Halo Dot uses attestation to ensure that the device has not been compromised and that the application that is running the SDK has not altered. Any attestation failures will result in exceptions being raised and the SDK will fail to initialise and transact. In most cases, these will be returned through the ",(0,s.jsx)(t.code,{children:"HaloInitializationResult"})," and ",(0,s.jsx)(t.code,{children:"HaloTransactionResult"})," objects. However, due to attestations that occur in the background, attestation errors can also be reported using the ",(0,s.jsx)(t.code,{children:"onAttestationError"})," callback.","\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Play Integrity",(0,s.jsx)(t.br,{}),"\n","Google services are used to determine if the application has been tampered with and if the device profile is known to Google."]}),"\n",(0,s.jsxs)(t.li,{children:["Whitebox attestation",(0,s.jsx)(t.br,{}),"\n","A custom attestation process is used to verify the integrity of the Whitebox to ensure that PINs can be securely captured."]}),"\n",(0,s.jsxs)(t.li,{children:["Key attestation",(0,s.jsx)(t.br,{}),"\n","Android key attestation is used to check if the bootloader has been unlocked and to verify the signature on the application."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Certificate pinning"}),(0,s.jsx)(t.br,{}),"\n","The SDK uses certificate pinning to protect against man in the middle attacks and to prevent malicious CA's from being used to bypass legitimate Halo Dot servers. The certificate PIN is provided in the JWT that the SDK uses and contains the SHA256 hash of the public key of the server certificate. Since the JWT is provided by the integrating application, it is vitally important to protect the integrity of the JWT. Please see the key management section for guidance on protecting the JWT signing keys."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Encryption and signing of messages to and from the server"}),(0,s.jsx)(t.br,{}),"\n","In addition to using TLS 1.2+, all messages between the SDK to the backend server are signed and encrypted at application level. During initial device registration, key exchanges are performed to allow secure communcation. If either the server or SDK fails to validate the signature of a message, an exception is raised and the operation is aborted."]}),"\n"]}),"\n",(0,s.jsxs)(t.h3,{id:"permissions-required-",children:["Permissions required ",(0,s.jsx)("a",{href:"#permissions-required",id:"permissions-required"})]}),"\n",(0,s.jsx)(t.p,{children:"The Halo Dot SDK requires a number of permissions to function. Some of these permissions require user intervention, so integrators are required to ask for these permissions before attempting to initialise the SDK. The permissions that require user intervention are:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Bluetooth"}),(0,s.jsx)(t.br,{}),"\n","This permission is required to determine if any devices are connected to the mobile device. This is an attestation requirement to determine if any known malicious devices are connected."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Microphone"}),(0,s.jsx)(t.br,{}),"\n","The microphone must be monitored to prevent side channel attacks and to prevent malicious applications from capturing sensitive card holder information. The SDK does not do anything with the microphone other than prevent other apps from using it."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Location"}),(0,s.jsx)(t.br,{}),"\n","Each transaction that is submitted contains the GPS co-ordinates of the device. This is to help detect fraud."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Camera"}),(0,s.jsx)(t.br,{}),"\n","The camera must be held to prevent malicious applications from capturing card details while it is being tapped on the phone. The SDK does not do anything with the camera other than prevent other applications from using it."]}),"\n"]})]})}function l(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);