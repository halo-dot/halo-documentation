"use strict";(self.webpackChunkhalo_documentation=self.webpackChunkhalo_documentation||[]).push([[5713],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>o});var i=t(96540);const s={},r=i.createContext(s);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(r.Provider,{value:n},e.children)}},65424:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"documentations/sdk/sdk-integration-guide","title":"SDK Mobile Integration Guide","description":"This README provides technical guidance on the integration of the Halo.SDK with a host Android application.&#x20;","source":"@site/versioned_docs/version-2.1/documentations/sdk/02 - sdk-integration-guide.md","sourceDirName":"documentations/sdk","slug":"/documentations/sdk/sdk-integration-guide","permalink":"/docs/versioned_docs/version-2.1/documentations/sdk/sdk-integration-guide","draft":false,"unlisted":false,"tags":[],"version":"2.1","sidebarPosition":2,"frontMatter":{},"sidebar":"documentationSidebar","previous":{"title":"Accessing the SDK","permalink":"/docs/versioned_docs/version-2.1/documentations/sdk/getting-started-with-sdk"},"next":{"title":"Halo System Baseline","permalink":"/docs/versioned_docs/version-2.1/documentations/sdk/halo-system-baseline"}}');var s=t(74848),r=t(28453);const a={},o="SDK Mobile Integration Guide",l={},c=[{value:"1. Remote Attestation of Application by Halo Server",id:"1-remote-attestation-of-application-by-halo-server",level:2},{value:"2. Requirements on the Mobile Back-End",id:"2-requirements-on-the-mobile-back-end",level:2},{value:"3. SDK Binary",id:"3-sdk-binary",level:2},{value:"4. Application Manifest",id:"4-application-manifest",level:2},{value:"5. Life-Cycle Methods",id:"5-life-cycle-methods",level:2},{value:"6. Initialization of the SDK",id:"6-initialization-of-the-sdk",level:2},{value:"7. Transaction Flow",id:"7-transaction-flow",level:2},{value:"8. SDK Async Behaviour after startTransaction Returns",id:"8-sdk-async-behaviour-after-starttransaction-returns",level:2},{value:"9. Conclusion",id:"9-conclusion",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"sdk-mobile-integration-guide",children:"SDK Mobile Integration Guide"})}),"\n",(0,s.jsx)(n.p,{children:"This README provides technical guidance on the integration of the Halo.SDK with a host Android application. "}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsx)(n.tr,{children:(0,s.jsx)(n.th,{children:"The Halo Dot SDK is an Isolating MPoC SDK payment processing MPOC Software with Attestation & Monitoring Capabilities."})})}),(0,s.jsx)(n.tbody,{children:(0,s.jsx)(n.tr,{children:(0,s.jsxs)(n.td,{children:[(0,s.jsx)("p",{children:"The Architecture of this isolating MPoC Payment Software, is described in the diagram below."}),(0,s.jsx)("p",{}),(0,s.jsx)("p",{children:"The below diagram also showcases the SDK boundary and the interaction between the SDK its integrating channels, and the 3rd party payment gateway. It also describes the boundary of the SDK and how it interacts with integrators and the third party payments. It also includes details of how the data is communicated sent in-between the boundary.  "})]})})})]}),"\n",(0,s.jsxs)("figure",{children:[(0,s.jsx)("img",{src:"/img/SDKBoundry.png",alt:""}),(0,s.jsx)("figcaption",{children:(0,s.jsx)("p",{children:"SDK Boundry"})})]}),"\n",(0,s.jsxs)("figure",{children:[(0,s.jsx)("img",{src:"/img/halodot-backend.png",alt:""}),(0,s.jsx)("figcaption",{children:"Halo Backend"})]}),"\n",(0,s.jsx)(n.p,{children:"The Halo.SDK is an isolated system development kit with A&M functionality. It operates in an isolated memory space, which provides sufficient separation of data processing between the SDK and other software (including the integrating app)."}),"\n",(0,s.jsx)(n.h2,{id:"1-remote-attestation-of-application-by-halo-server",children:"1. Remote Attestation of Application by Halo Server"}),"\n",(0,s.jsx)(n.p,{children:"In accordance with prescribed security requirements, the Halo server performs remote attestation of the application using the Google Play Integrity attestation framework."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"APK Values Required by Halo Server for Remote Attestation"})}),"\n",(0,s.jsx)(n.p,{children:"The following attestation payload field must be configured in the Halo server with each release so that they can be checked by the server during remote attestation."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"field"}),(0,s.jsx)(n.th,{children:"description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"apkPackageName"}),(0,s.jsx)(n.td,{children:"fully qualified APK name, e.g. za.co.synthesis.halo.halo_mpos_new"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"apkCertificateDigestSha256"}),(0,s.jsx)(n.td,{children:"base64 encoded, SHA-256 hash of the certifi cate used to sign requesting app"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"applicationVersion"}),(0,s.jsx)(n.td,{children:"version number of application of host application"})]})]})]}),"\n",(0,s.jsx)(n.h2,{id:"2-requirements-on-the-mobile-back-end",children:"2. Requirements on the Mobile Back-End"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"JWT"})}),"\n",(0,s.jsxs)(n.p,{children:["All calls were made to the Halo.SDK requires a valid JWT. The mobile application server is expected to supply the mobile app with a JWT that can be used to authenticate with the Halo Kernel Server. The SDK requires a callback function, ",(0,s.jsx)(n.code,{children:"onRequestJWT(callback: (String) -> Unit)"}),", that it will use whenever a JWT is required."]}),"\n",(0,s.jsx)(n.p,{children:"An asymmetric key is used so that the JWT can be issued (signed) by one system (mobile application server), and independently verified by another (Halo server)."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"JWT LifeTime"})}),"\n",(0,s.jsx)(n.p,{children:"Since the JWT essentially authorizes payment acceptance for a given merchant user, it is essential that the JWT lifetime be kept as short as possible, in order to limit the amount of time an attacker has to crack the key itself and then to limit the scope of damage in the event of a key compromise."}),"\n",(0,s.jsx)(n.p,{children:"A lifetime of 15 minutes is recommended."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"JWT Signing Public Key Format"})}),"\n",(0,s.jsx)(n.p,{children:"The JWT public key should be published as a certificate, in a text-friendly format, e.g. B64 encoded PEM (.crt, .pem)."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"JWT Serialization Format"})}),"\n",(0,s.jsx)(n.p,{children:"The compact serialization format is expected, i.e:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"urlencodedB64(header) + '.' + urlencodedB64(payload) + '.' + urlencodedB64(signature)\n"})}),"\n",(0,s.jsx)(n.p,{children:"For example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJsb2dnZWRJbkFzIjoiYWRtaW4iLCJpYXQiOjE0MjI3Nzk2Mzh9.gzSraSYS8EXBxLN_oWnFSRgCzcmJmMjLiuyu5CSpyH\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"JWT Claims"})}),"\n",(0,s.jsx)(n.p,{children:"The JWT must make a number of claims - all of them standard except for aud_fingerprints (Audience Fingerprints):"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"field"}),(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"type"}),(0,s.jsx)(n.th,{children:"Note"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"alg"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"String"}),(0,s.jsx)(n.td,{children:"The signing algorithm is RSA signed SHA-256 hash, aliased as RS256. An asymmetric encryption(signing) scheme is required to allow the Kernel Server to be able to validate the token without being able to generate it. If symmetric key encryption was used to sign the auth token (e.g., using the HMAC algorithm), then non-repudiation would be lost."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"sub"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"String"}),(0,s.jsx)(n.td,{children:"The Payment Processor Merchant-User ID, or Application ID"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"iss"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"String"}),(0,s.jsx)(n.td,{children:"This is a unique (from the perspective of Halo server) identifier for the JWT issuer, agreed upon by the JWT issuer and Synthesis, and configured in advance by Synthesis in the Halo server, e.g. authserver.haloplus.io"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"aud"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"String"}),(0,s.jsx)(n.td,{children:"URL of Halo server TLS endpoint, e.g. 'kernelserver.qa.haloplus.io'. This value should be obtained from Synthesis (different per environment) e.g. for QA it would be 'kernelserver.qa.haloplus.io' and for DEV 'kernelserver.za.dev.haloplus.io'"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"usr"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"String"}),(0,s.jsx)(n.td,{children:"The details of the user performing the transaction, typically the username used to sign into the Integrators application."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"iat"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"NumericDate"}),(0,s.jsx)(n.td,{children:"The UTC timestamp of when the JWT was generated."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"exp"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"NumericDate"}),(0,s.jsx)(n.td,{children:"The UTC time of expiration of the JWT."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"aud_fingerprints"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"String"}),(0,s.jsx)(n.td,{children:'a CSV list of expected SHA-256 fingerprints for the Kernel Server TLS endpoint. This list may contain multiple values to support certificate rotation. In the QA environment, the expected value as of writting this would be: "sha256/zc6c97JhKPZUa+rIrVqjknDE1lDcDK77G41sDo+1ay0="'})]})]})]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"If using the Halo Dot Adaptor, the following additional fields are required"})}),"\n",(0,s.jsx)(n.p,{children:"These are only supported from SDK version 4.0.2."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"field"}),(0,s.jsx)(n.th,{style:{textAlign:"center"},children:"type"}),(0,s.jsx)(n.th,{children:"Note"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"x-am-endpoint"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"String"}),(0,s.jsx)(n.td,{children:"URL of Halo A&M endpoint, e.g. 'kernelserver.qa.haloplus.io'."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"x-am-endpoint-fingerprints"}),(0,s.jsx)(n.td,{style:{textAlign:"center"},children:"String"}),(0,s.jsx)(n.td,{children:'a CSV list of expected SHA-256 fingerprints for the A&M endpoint. This list may contain multiple values to support certificate rotation. In the QA environment, the expected value as of writting this would be: "sha256/zc6c97JhKPZUa+rIrVqjknDE1lDcDK77G41sDo+1ay0="'})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:['All these values can be validated by making a POST request to "',(0,s.jsx)(n.a,{href:"https://kernelserver.qa.haloplus.io/tokens/checkjwt",children:"https://kernelserver.qa.haloplus.io/tokens/checkjwt"}),'". Your JWT should be added as header (Bearer Auth).']}),"\n",(0,s.jsx)(n.h2,{id:"3-sdk-binary",children:"3. SDK Binary"}),"\n",(0,s.jsx)(n.p,{children:"HaloSDK is written in Kotlin and packaged as an AAR (Android Archive Library). For security reasons, the compiled binary has been obfuscated."}),"\n",(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.a,{href:"/docs/documentations/sdk/getting-started-with-sdk",children:"Getting Started Guide"})," for a detailed guide on accessing and getting started with the SDK."]}),"\n",(0,s.jsx)(n.h2,{id:"4-application-manifest",children:"4. Application Manifest"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"AndroidManifest.xml"})," application manifest file of the mobile application must include the following user permissions:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"android.permission.INTERNET"})," - call out to the backend over the internet"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"android.permission.NFC"}),"- use the NFC module"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["In addition, in order to indicate to the Play store that this is an NFC-enabled app, the ",(0,s.jsx)(n.code,{children:"android.hardware.nfc"})," the feature needs to be specifi ed, with ",(0,s.jsx)(n.code,{children:"required=false"})," . If required is set to true then the mobile app itself will not be allowed to be installed on devices that don't support NFC, which is presumed to not be the desired behavior."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Android Gradle Plugin > 3.4.2"})}),"\n",(0,s.jsxs)(n.p,{children:["Due to a limitation with the TEE library that is used, if the Android Gradle Plugin (",(0,s.jsx)(n.code,{children:"classpath 'com.android.tools.build:gradle'"}),") is greater than 3.4.2, the following attribute needs to be added to the application element inside the Android Manifest application"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'android:extractNativeLibs="true"\n'})}),"\n",(0,s.jsx)(n.h2,{id:"5-life-cycle-methods",children:"5. Life-Cycle Methods"}),"\n",(0,s.jsxs)(n.p,{children:["In order for the SDK to properly handle the Android application life cycle, the host app needs to add hooks into the following Android lifecycle methods on the ",(0,s.jsx)(n.code,{children:"MAIN activity"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["\u26a0\ufe0f"," ",(0,s.jsx)(n.strong,{children:"do not hook up to a SUB activity or a fragment"})," as this will cause problems"]}),"\n",(0,s.jsx)(n.p,{children:"List of Android lifecycle methods:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"onCreate(Bundle savedInstanceState)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"onStart()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"onResume()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"onPause()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"onStop()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"onSaveInstanceState(Bundle outState, PersistableBundle outPersistentState)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"onSaveInstanceState(Bundle outState)"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"onDestroy()"})}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Halo.SDK has corresponding static methods with matching method signatures for each of the Android lifecycle methods."}),"\n",(0,s.jsx)(n.p,{children:"This can all be wired up as follows:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public class MainActivity extends AppCompatActivity {\n    @Override\n    public void onCreate(Bundle savedInstanceState, PersistableBundle persistentState) {\n        super.onCreate(savedInstanceState, persistentState);\n        // your mobile app code here\n        HaloSDK.onCreate(this , this, savedInstanceState, persistentState);\n    }\n\n    @Override\n    protected void onStart() {\n        super.onStart();\n        // your mobile app code here\n        HaloSDK.onStart();\n    }\n\n    @Override\n    protected void onResume() {\n        super.onResume();\n        // your mobile app code here\n        HaloSDK.onResume();\n    }\n\n    @Override\n    protected void onPause() {\n        super.onPause();\n        // your mobile app code here\n        HaloSDK.onPause();\n    }\n\n    @Override\n    protected void onStop() {\n        super.onStop();\n        // your mobile app code here\n        HaloSDK.onStop();\n    }\n\n    @Override\n    public void onSaveInstanceState(@NonNull Bundle outState, @NonNull PersistableBundle outPersistentState) {\n        super.onSaveInstanceState(outState, outPersistentState);\n        // your mobile app code here\n        HaloSDK.onSaveInstanceState(outState, outPersistentState);\n    }\n\n    @Override\n    protected void onSaveInstanceState(@NonNull Bundle outState) {\n        super.onSaveInstanceState(outState);\n        // your mobile app code here\n        HaloSDK.onSaveInstanceState(outState);\n    }\n\n    @Override\n    protected void onDestroy() {\n        super.onDestroy();\n        // your mobile app code here\n        HaloSDK.onDestroy();\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"6-initialization-of-the-sdk",children:"6. Initialization of the SDK"}),"\n",(0,s.jsxs)(n.p,{children:["Separate from the lifecycle hooks, the SDK must be initialized before transacting by calling the static ",(0,s.jsx)(n.code,{children:"initialize"})," method on the SDK, passing it a ",(0,s.jsx)(n.code,{children:"HaloInitializationParameters"})," object."]}),"\n",(0,s.jsx)(n.p,{children:"The SDK will attempt to perform the following sequence of actions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"the Perform runtime checks (the device is not rooted, running in debug mode, or under instrumentation)"}),"\n",(0,s.jsx)(n.li,{children:"Confirm that the software (Android version) and hardware platform (NFC device) is sufficient"}),"\n",(0,s.jsx)(n.li,{children:"Connect to the server, passing on the JWT for verification"}),"\n",(0,s.jsx)(n.li,{children:"Confirm that the device has been enrolled, and is not blocked - re-enrolling if necessary"}),"\n",(0,s.jsx)(n.li,{children:"Perform device-local Google Play Integrity key attestation actions, and submit results to the server for remote verification"}),"\n",(0,s.jsx)(n.li,{children:"Retrieve terminal configuration from the server"}),"\n",(0,s.jsx)(n.li,{children:"Initialize the SDK to a state where it will accept transactions"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The result will be communicated, typically asynchronously (depending on exactly what happens and when), to the host application via invoking the callback registered in ",(0,s.jsx)(n.code,{children:"IHaloCallbacks.onInitializationResult"})," and passing a ",(0,s.jsx)(n.code,{children:"HaloInitializationResult"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"HaloInitializationResult.resultType"})," field indicates whether or not the initialization was successful or not. A value ",(0,s.jsx)(n.code,{children:"Initialized"})," indicates success, all other values indicate some kind of failure."]}),"\n",(0,s.jsxs)(n.p,{children:["In the case of failure, the ",(0,s.jsx)(n.code,{children:"errorCode"})," field may hold more information, whereas in the case of success, the SDK is now ready to accept a transaction."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"HaloInitializationParameters"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"import za.co.synthesis.halo.sdk.model.HaloInitializationParameters\n\npublic class HaloInitializationParameters {\n    public IHaloCallbacks haloCallBacks;\n    public Long cardTimeTimeoutMS;\n    public String applicationName;\n    public String applicationVersion;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Long cardTimeTimeoutMS"})," - Timeout value, in milliseconds, that the SDK will wait for a card tap after startTransaction has been called, before returning with a timeout error."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"String applicationName"})," - The fully qualified package name of the calling application."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"String applicationVersion"})," - The version number of the calling application."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"IHaloCallbacks haloCallBacks"})," - See below discussion on the ",(0,s.jsx)(n.code,{children:"IHaloCallbacks"})," interface."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"IHaloCallbacks"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"import za.co.synthesis.halo.sdk.model.IHaloCallbacks\n\npublic interface IHaloCallbacks {\n    void onInitializationResult(HaloInitializationResult result);\n    void onHaloUIMessage(HaloUIMessage message);\n    void onHaloTransactionResult(HaloTransactionResult result);\n    void onRequestJWT(Function1<? super String, Unit> function1);\n    void onAttestationError(HaloAttesationHealthResult result);\n    void onCameraControlLost();\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"IHaloCallbacks"})," interface encapsulates the call-back methods that the HaloSDK will use to asynchronously communicate back to the host application at relevant junctures:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["The outcome of the initialization process (",(0,s.jsx)(n.code,{children:"onInitializationResult"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Interim transaction progress (",(0,s.jsx)(n.code,{children:"onHaloUIMessage"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Final outcome of a transaction (",(0,s.jsx)(n.code,{children:"onHaloTransactionResult"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Issues with intermittent attestation checks (",(0,s.jsx)(n.code,{children:"onAttestationError"}),")"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"HaloInitializationResult"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"import za.co.synthesis.halo.sdk.model.HaloInitializationResult\n\npublic class HaloInitializationResult {\n    public HaloInitializationResultType resultType;\n    public Currency terminalCurrency;\n    public List<String> terminalLanguageCodes;\n    public String terminalCountryCode;\n    public String message;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Notes on ",(0,s.jsx)(n.code,{children:"HaloInitializationResult"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"HaloInitializationResultType"})}),"\n",(0,s.jsxs)(n.p,{children:["Here is a list of possible values for ",(0,s.jsx)(n.code,{children:"HaloInitializationResultType"})]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Value"}),(0,s.jsx)(n.th,{children:"Meaning"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Initialized"}),(0,s.jsx)(n.td,{children:"Success"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"AuthenticationError"}),(0,s.jsx)(n.td,{children:"Error occurred during authentication"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"NetworkError"}),(0,s.jsx)(n.td,{children:"Network socket error during connection to server"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"UnsupportedOperatingSystemVersion"}),(0,s.jsx)(n.td,{children:"Android OS too low"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"RootedDevice"}),(0,s.jsx)(n.td,{children:"Device rooting detected"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"InstrumentedDevice"}),(0,s.jsx)(n.td,{children:"Runtime instrumentation detected"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DebuggedDevice"}),(0,s.jsx)(n.td,{children:"Debug mode detected"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"GeneralError"}),(0,s.jsx)(n.td,{children:"General failure"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"RemoteAttestationFailure"}),(0,s.jsx)(n.td,{children:"Device failed remote leg of Android Play Integrity attestation"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"NFCDisabledError"}),(0,s.jsx)(n.td,{children:"NFC either absent, turned off, or NFC permission not granted"})]})]})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Terminal Localisation Information Returned in ",(0,s.jsx)(n.code,{children:"HaloInitializationResult"})]}),"\n",(0,s.jsx)(n.p,{children:"As part of initialization, the SDK will fetch its pre-defined terminal configuration from the Halo server - and this includes localization data which should be checked by the host application to ensure that the terminal is transacting in the expected currency, which is required for the limit checks done as part of kernel processing to be performed in the correct matching currency. In addition, these values should be used to determine the correct currency symbol and a number of decimal points to use when displaying the transaction amount to the cardholder."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"terminalLanguageCodes"})}),"\n",(0,s.jsx)(n.p,{children:"The EMV terminal specification dictates that the terminal be configured with a list of language preferences (ISO 639-1 alpha2 language code), ordered from highest to lowest priority. The mobile app should ideally use this list to determine which language to use for display purposes."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"terminalCurrency"})}),"\n",(0,s.jsx)(n.p,{children:"The terminal has a single supported currency. This is the currency in which card risk limits are configured, and the transaction must be conducted. It is also the currency that must be used when displaying amounts. The mobile app should determine the correct currency symbol and a number of decimal places from this. If this value is not as expected, then the mobile app should not allow transactions."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"terminalCountryCode"})}),"\n",(0,s.jsx)(n.p,{children:"The terminal is configured with a country code that indicates the domestic country. The returned value is formatted as an ISO 3166-1 numeric 3 country code left padded with zeros to length 4, e.g. 0710 = South Africa."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"7-transaction-flow",children:"7. Transaction Flow"}),"\n",(0,s.jsx)(n.p,{children:"This section describes the Transaction flow of the SDK in more detail."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"HaloSDK.startTransaction"})}),"\n",(0,s.jsxs)(n.p,{children:["Once the SDK has been successfully initialized, as indicated by a ",(0,s.jsx)(n.code,{children:"HaloInitializationResultType"})," of ",(0,s.jsx)(n.code,{children:"Success"}),", a transaction may be initiated by calling ",(0,s.jsx)(n.code,{children:"HaloSDK.startTransaction"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public final fun startTransaction(\n    transactionAmount: java.math.BigDecimal,\n    merchantTransactionReference: kotlin.String\n): za.co.synthesis.halo.sdk.model.HaloStartTransactionResult\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Let's take a closer look at ",(0,s.jsx)(n.code,{children:"startTransaction"})," parameters:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"transactionAmount"})," - The purchase amount, stated in the ",(0,s.jsx)(n.code,{children:"terminalCurrency"})," as returned in ",(0,s.jsx)(n.code,{children:"HaloInitializationResult.terminalCurrency"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"merchantTransactionReference"})," - It is recommended to use a random GUID for this purpose."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"merchantTransactionReference"})," is a unique-per-merchant transaction reference generated and supplied by the mobile application. Halo will generate and maintain its own internal ID for the transaction (",(0,s.jsx)(n.code,{children:"haloTransactionReference"}),"), but from the perspective of the mobile application ",(0,s.jsx)(n.code,{children:"merchantTransactionReference"})," together with the value ",(0,s.jsx)(n.code,{children:"Payment Processor Merchant-User ID"})," specified in the JWT ",(0,s.jsx)(n.code,{children:"sub"})," field can be used to uniquely identify a merchant transaction."]}),"\n",(0,s.jsxs)(n.p,{children:["This value needs to be unique per merchant transaction, i.e. different merchants could use the same ",(0,s.jsx)(n.code,{children:"merchantTransactionReference"})," for two different transactions, but the value would need to be unique per transaction for a given merchant. In the event that the same ",(0,s.jsx)(n.code,{children:"merchantTransactionReference"})," is supplied for two different transactions for the same merchant, the second transaction will be rejected by the Halo server, and the final transaction result type returned for the second transaction will be ",(0,s.jsx)(n.code,{children:"HaloTransactionResultType.DuplicateMerchantTransactionReferenceSupplied"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["In the event of the final transaction result type being ",(0,s.jsx)(n.code,{children:"HaloTransactionResultType.Indeterminate"})," , then it is the ",(0,s.jsx)(n.code,{children:"merchantTransactionReference"})," that should be used to look up and potentially resolve the final transaction outcome - potentially through a manual reversal by the merchant via the web portal."]}),"\n",(0,s.jsxs)(n.p,{children:["The return type of ",(0,s.jsx)(n.code,{children:"startTransaction"})," is ",(0,s.jsx)(n.code,{children:"HaloStartTransactionResult"})," and is defined as:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"import za.co.synthesis.halo.sdk.model.HaloTransactionResult\n    public class HaloStartTransactionResult {\n        public HaloStartTransactionResultType resultType;\n        public String message;\n    }\n"})}),"\n",(0,s.jsxs)(n.p,{children:["where ",(0,s.jsx)(n.code,{children:"HaloStartTransactionResultType"})," is:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"import za.co.synthesis.halo.sdk.model.HaloTransactionResultType\n    public enum HaloStartTransactionResultType {\n        Started,\n        NotInitialized,\n        GeneralError,\n        NFCDisabledError;\n    }\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Start Transaction Flow"})}),"\n",(0,s.jsx)(n.p,{children:"As part of starting a transaction, the SDK will check:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"NFC is present and turned on"}),"\n",(0,s.jsx)(n.li,{children:"SDK itself has been successfully initialized"}),"\n",(0,s.jsx)(n.li,{children:"Platform runtime (root/debug/instrumentation)"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"HaloSDK.startTransaction"})," will always synchronously return a ",(0,s.jsx)(n.code,{children:"HaloStartTransactionResultType"}),", only a value of ",(0,s.jsx)(n.code,{children:"Started"})," indicates that the SDK is satisfied to actually start a new transaction, all other values indicate a failure of some kind."]}),"\n",(0,s.jsxs)(n.p,{children:["In the event of a failure, the return of the ",(0,s.jsx)(n.code,{children:"startTransaction"})," method signals the end of the transaction and Halo.SDK will invoke no further callbacks, and this outcome should be regarded as the final outcome of this transaction, and full control returns to the mobile application."]}),"\n",(0,s.jsxs)(n.p,{children:["If the SDK is able to start the transaction, ",(0,s.jsx)(n.code,{children:"startTransaction"})," will return a ",(0,s.jsx)(n.code,{children:"HaloStartTransactionResultType"})," of ",(0,s.jsx)(n.code,{children:"Started"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["From this point onwards, Halo.SDK will communicate interim transaction progress back to the mobile application by means of invoking the ",(0,s.jsx)(n.code,{children:"IHaloCallback.onHaloUIMessage"}),"callback function, and the final transaction outcome by invoking the ",(0,s.jsx)(n.code,{children:"IHaloCallback.onHaloTransactionResult"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Informing the Merchant of a Tamper Event"})}),"\n",(0,s.jsxs)(n.p,{children:["If ",(0,s.jsx)(n.code,{children:"HaloSDK.startTransaction"})," returns a result type of ",(0,s.jsx)(n.code,{children:"RootedDevice"}),", ",(0,s.jsx)(n.code,{children:"InstrumentedDevice"})," or ",(0,s.jsx)(n.code,{children:"DebuggedDevice"}),", then the EMV specification dictates that it is mandatory for the host application to immediately inform the merchant on screen that their device has been tampered with."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Communication of Interim Status"})}),"\n",(0,s.jsxs)(n.p,{children:["Before the final transaction outcome is communicated via ",(0,s.jsx)(n.code,{children:"IHaloCallbacks.onHaloTransactionResult"}),", interim transaction progress will typically be communicated to the mobile app via invoking ",(0,s.jsx)(n.code,{children:"IHaloCallbacks.onHaloUIMessage"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"void onHaloUIMessage(HaloUIMessage message);\n"})}),"\n",(0,s.jsx)(n.p,{children:"It is expected that the mobile app will use these message events as triggers for communicating interim transaction status information or action prompts such as present card, remove card, present card again to the card holder."}),"\n",(0,s.jsxs)(n.p,{children:["Let's have a closer look at ",(0,s.jsx)(n.code,{children:"HaloUIMessage"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"import za.co.synthesis.halo.sdk.model.HaloUIMessage\n\npublic class HaloUIMessage {\n    public HaloUIMessageID msgID;\n    public int holdTimeMS;\n    public List<String> languagePreference;\n    public HaloCurrencyValue offlineBalance;\n    public HaloCurrencyValue transactionAmount;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["And the parameters of ",(0,s.jsx)(n.code,{children:"HaloUIMessage"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"HaloUIMessageID msgID"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"msgID"})," field indicates the interim transaction status, which should be communicated to the user. The following are the types that ",(0,s.jsx)(n.code,{children:"msgID"})," can be:"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Enum"}),(0,s.jsx)(n.th,{children:"Text"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"PresentCard"}),(0,s.jsx)(n.td,{children:"Present Card"}),(0,s.jsx)(n.td,{children:"Initial message, accompanied by transaction amount"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Processing"}),(0,s.jsx)(n.td,{children:"Processing..."}),(0,s.jsxs)(n.td,{children:["May occur between ",(0,s.jsx)(n.code,{children:"PresentCard"})," and ",(0,s.jsx)(n.code,{children:"CardReadOK_RemoveCard"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"CardReadOK_RemoveCard"}),(0,s.jsx)(n.td,{children:"Card Read OK, Remove Card"}),(0,s.jsx)(n.td,{children:"Card reading has been completed and user should remove card"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"SeePhoneForInstructions_ThenTapAgain"}),(0,s.jsx)(n.td,{children:"See Phone for Instructions, then Tap Again"}),(0,s.jsx)(n.td,{children:"Authorise transaction on payment device, then tap again"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"AuthorisingWait"}),(0,s.jsx)(n.td,{children:"Authorising, Please Wait..."}),(0,s.jsx)(n.td,{children:"Attempting online authorization"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TryAgain"}),(0,s.jsx)(n.td,{children:"Try Again"}),(0,s.jsx)(n.td,{children:"Initial card read failed, cardholder to present card again - transaction still in progress"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TryAnotherCard"}),(0,s.jsx)(n.td,{children:"Try Another Card"}),(0,s.jsx)(n.td,{children:"Transaction failed, start a new transaction with a different card"})]})]})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"int holdTimeMS"})}),"\n",(0,s.jsx)(n.p,{children:"The EMV terminal specification dictates that when multiple messages are received in quick succession for the same transaction, each message must be displayed for a minimum amount of time (the message hold time), before proceeeding to display the next message. This is intended to allow the user enough time to read eachmessage, and typically results in queue-based implementations."}),"\n",(0,s.jsx)(n.p,{children:"holdTimeMS refl ect the message hold time, in units of milliseconds."}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"List languagePreference"})," The EMV specification dictates that cards may include a list of language preferences. If the card does contain such a list, it will be specified in ",(0,s.jsx)(n.code,{children:"HaloUIMessage"})," as ",(0,s.jsx)(n.code,{children:"languagePreference"}),", which is a list of ISO 639-1 alpha2 language codes, in order of language."]}),"\n",(0,s.jsx)(n.p,{children:"The mobile application can then choose to display the UI message texts in a preferred language, or if not specifi ed, in its default language."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"IHaloCallbacks.onHaloTransactionResult"})}),"\n",(0,s.jsxs)(n.p,{children:["Once it has completed processing, Halo.SDK communicates the final transaction outcome to the mobile application via invoking the ",(0,s.jsx)(n.code,{children:"IHaloCallbacks.onHaloTransactionResult"})," callback, and passing it a ",(0,s.jsx)(n.code,{children:"HaloTransactionResult"})," object. Once the mobile application receives a ",(0,s.jsx)(n.code,{children:"HaloTransactionResult"}),", it can regard the transaction as concluded, and assume full control again."]}),"\n",(0,s.jsxs)(n.p,{children:["Here is a closer look at ",(0,s.jsx)(n.code,{children:"HaloTransactionResult"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"public class HaloTransactionResult {\n    public HaloTransactionResultType resultType;\n    public String merchantTransactionReference;\n    public String haloTransactionReference;\n    public String paymentProviderReference;\n    public String message;\n    public HaloTransactionReceipt receipt;\n    public Map<String, String> customTags;\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["And the parameters of ",(0,s.jsx)(n.code,{children:"HaloTransactionResult"}),":"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.code,{children:"HaloTransactionResultType resultType"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"HaloTransactionResultType resultType"})," field indicates the final transaction status to the host application."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Value"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Approved"}),(0,s.jsx)(n.td,{children:"Transaction successfully approved online"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Declined"}),(0,s.jsx)(n.td,{children:"Transaction declined, either offl ine by terminal or card, or onliny by issuer"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"CardTapTimeOutExpired"}),(0,s.jsx)(n.td,{children:"Timed out waiting for a card tap"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"NetworkError"}),(0,s.jsx)(n.td,{children:"Network socket communication error"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ProcessingError"}),(0,s.jsx)(n.td,{children:"An error occurred during EMV card processing"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Cancelled"}),(0,s.jsx)(n.td,{children:"Transaction called by host application"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TryAnotherCard"}),(0,s.jsx)(n.td,{children:"Transaction failed with this card, but may succeeed with another card"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"NFCDisabledError"}),(0,s.jsx)(n.td,{children:"NFC on the device is turned off"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"NotAuthenticated"}),(0,s.jsx)(n.td,{children:"Invalid JWT token provided"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Indeterminate"}),(0,s.jsx)(n.td,{children:"Unknown transaction status, inform merchant to manually query transaction status via merchant portal before giving goods"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"DuplicateMerchantTransactionReferenceSupplied"}),(0,s.jsx)(n.td,{children:"Transaction rejected by server due to use of duplicate merchant transaction reference. attempt again with a new reference"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"HealthError"}),(0,s.jsx)(n.td,{children:"An error occurred while checking the status of the Kernel Server"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"InvalidJWT"}),(0,s.jsx)(n.td,{children:"An error occurred while parsing the JWT"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Only if a ",(0,s.jsx)(n.code,{children:"HaloTransactionResultType"})," of ",(0,s.jsx)(n.code,{children:"Approved"})," is received should the merchant be instructed that the transaction has been successful. If a result of type ",(0,s.jsx)(n.code,{children:"Indeterminate"})," is returned, then the merchant ",(0,s.jsx)(n.strong,{children:"MUST"})," be instructed to query the Payment Processor as to the final transaction outcome - ",(0,s.jsx)(n.strong,{children:"BEFORE"})," giving goods/services. This will typically be done either through the host application itself, or via the payment processor's merchant management portal. All other values should be regarded as conclusively indicating that the transaction has failed."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"Transaction References"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Reference"}),(0,s.jsx)(n.th,{children:"Source"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"merchantTransactionReference"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"HaloSDK.startTransaction.merchantTransactionReference"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"haloTransactionReference"}),(0,s.jsx)(n.td,{children:"Halo server"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"paymentProviderReference"}),(0,s.jsx)(n.td,{children:"Payment Provider"})]})]})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"HaloTransactionReceipt"}),"\n",(0,s.jsxs)(n.p,{children:["EMV receipt information is specified in ",(0,s.jsx)(n.code,{children:"HaloTransactionResult.receipt"}),". Approved transactions will always contain receipt information, whereas this is not guaranteed in the case of declined transactions."]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Field"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"transactionDate"}),(0,s.jsx)(n.td,{children:"Transaction Date, YYMMDD"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"transactionTime"}),(0,s.jsx)(n.td,{children:"Transaction Time, HHMMSS"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"aid"}),(0,s.jsx)(n.td,{children:"Application ID, 16 hex chars"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"applicationLabel"}),(0,s.jsx)(n.td,{children:"Application Label, 16 chars"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"applicationPreferredName"}),(0,s.jsx)(n.td,{children:"Application Preferred Name, 16 chars"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"tvr"}),(0,s.jsx)(n.td,{children:"Terminal Verification Results, 10 hex chars"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"cvr"}),(0,s.jsx)(n.td,{children:"Card Verification Results, hex"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"cryptogramType"}),(0,s.jsx)(n.td,{children:"Application Cryptogram type: AAC, TC, ARQC"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"cryptogram"}),(0,s.jsx)(n.td,{children:"Application Cryptogram, 16 hex chars"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"maskedPAN"}),(0,s.jsx)(n.td,{children:"Card PAN masked according to PCI, 16 chars"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"authorizationCode"}),(0,s.jsx)(n.td,{children:"The final authorization code returned by the issuer in the online response, 12 chars"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"ISOResponseCode"}),(0,s.jsx)(n.td,{children:"Authorisation Response Code returned by the issuer in the online response"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"association"}),(0,s.jsx)(n.td,{children:"Card scheme: MasterCard, Visa, AMEX"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"expiryDate"}),(0,s.jsx)(n.td,{children:"Card application expiry date"})]})]})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"8-sdk-async-behaviour-after-starttransaction-returns",children:"8. SDK Async Behaviour after startTransaction Returns"}),"\n",(0,s.jsxs)(n.p,{children:["Assuming that ",(0,s.jsx)(n.code,{children:"startTransaction"})," returns a synchronous result type of ",(0,s.jsx)(n.code,{children:"Started"})," , the SDK will continue with async transaction processing."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pre-Processing"})}),"\n",(0,s.jsxs)(n.p,{children:["The SDK will first perform transaction pre-processing as per the EMV specification. The transaction can be declined during pre-processing (typically due to terminal limits). In this case, the SDK will communicate this by calling ",(0,s.jsx)(n.code,{children:"IHaloCallbacks.onHaloTransactionResult"})," with ",(0,s.jsx)(n.code,{children:"HaloTransactionResult.resultType"})," as ",(0,s.jsx)(n.code,{children:"Declined"}),", then terminate, sending no UI messages."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Enablement of NFC Field"})}),"\n",(0,s.jsxs)(n.p,{children:["Assuming that pre-processing succeeds, the SDK will attempt to turn the NFC field on. If it is not able to do so (typically because NFC has not been enabled within phone settings), then the SDK will abandon the transaction, and return ",(0,s.jsx)(n.code,{children:"HaloTransactionResult.resultType"})," as ",(0,s.jsx)(n.code,{children:"NFCDisabledError"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Confirmation of Transaction Amount"})}),"\n",(0,s.jsxs)(n.p,{children:["Assuming that the NFC field could be enabled, the SDK will then send a ",(0,s.jsx)(n.code,{children:"PresentCard"})," ",(0,s.jsx)(n.code,{children:"HaloUIMessageID"}),", with the transaction amount specified in the ",(0,s.jsx)(n.code,{children:"transactionAmount"})," field. No action is required by the user to confirm the amount, the message is displayed only for information purposes."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Wait for Tap or Timeout"})}),"\n",(0,s.jsxs)(n.p,{children:["At this point, the SDK will wait for either a tag to be tapped, or for the card tap timeout to expire. If the timeout occurs, then the SDK will abandon the transaction,and return ",(0,s.jsx)(n.code,{children:"HaloTransactionResult.resultType"})," as ",(0,s.jsx)(n.code,{children:"CardTapTimeOutExpired"}),"."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"On Tap"})}),"\n",(0,s.jsx)(n.p,{children:"Assuming the card is tapped in time, the SDK will engage with the card. At this point, 1 of 2 things can happen:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["A processing error occurs during the card interaction. ",(0,s.jsx)(n.code,{children:"HaloTransactionResult.resultType"})," of ",(0,s.jsx)(n.code,{children:"ProcessingError"})," is returned, and the SDK abandons transaction."]}),"\n",(0,s.jsxs)(n.li,{children:["The card interaction completes successfully. In this case, the SDK will send a ",(0,s.jsx)(n.code,{children:"CardReadOK_RemoveCard"})," UI message, and continue with async transaction processing."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Potential for Offline Decline"})}),"\n",(0,s.jsxs)(n.p,{children:["Under some situations, the attempted online transaction may be declined offline by the card, in this case, the SDK will return a ",(0,s.jsx)(n.code,{children:"HaloTransactionResult.resultType"})," of ",(0,s.jsx)(n.code,{children:"Declined"}),", and abandon the transaction."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"PIN"})}),"\n",(0,s.jsx)(n.p,{children:"If the transaction amount exceeds the CVM limit and the card supports online PIN, the SDK will request a PIN for the transaction. This is handled transparently by the SDK using a Trusted User Interface, which will briefly assume control of the mobile device screen to capture a PIN."}),"\n",(0,s.jsx)(n.p,{children:"Once the PIN has been captured, control will return to the calling application."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Online Processing"})}),"\n",(0,s.jsx)(n.p,{children:"Assuming that the card interaction was successful, no processing errors were encountered, and that the card did not decline the transaction outright, then the SDK will attempt to prepare, submit and process an online transaction authorization request."}),"\n",(0,s.jsxs)(n.p,{children:["The SDK will send a ",(0,s.jsx)(n.code,{children:"OnlineProcessing"})," UI message to indicate that is begun online processing."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"General Error During Online Processing"})}),"\n",(0,s.jsxs)(n.p,{children:["If there is a general error during the preparation of the online request, the SDK will return a ",(0,s.jsx)(n.code,{children:"HaloTransactionResult.resultType"})," of ",(0,s.jsx)(n.code,{children:"ProcessingError"}),", and abandon the transaction."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Could Not go Online"})}),"\n",(0,s.jsxs)(n.p,{children:["If the SDK is unable to submit the online authorization request due to network connectivity issues, it will return a ",(0,s.jsx)(n.code,{children:"HaloTransactionResult.resultType"})," of ",(0,s.jsx)(n.code,{children:"NetworkError"}),", and abandon the transaction."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Ambiguous Transaction Outcome"})}),"\n",(0,s.jsxs)(n.p,{children:["In the event that the SDK was able to connect and submit an online authorization request, but did not receive a response, it will return a ",(0,s.jsx)(n.code,{children:"HaloTransactionResult.resultType"})," of ",(0,s.jsx)(n.code,{children:"Indeterminate"}),", and abandon the transaction."]}),"\n",(0,s.jsx)(n.p,{children:"In this case, the user must be instructed to consult the transaction back-end in order to determine the final transaction outcome before handing over the goods/services."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Final Transaction Outcome"})}),"\n",(0,s.jsxs)(n.p,{children:["Once the SDK has received and processed the online response, it will communicate the fi nal transaction outcome, which at this point should be one of ",(0,s.jsx)(n.code,{children:"Approved"}),", ",(0,s.jsx)(n.code,{children:"Declined"})," or ",(0,s.jsx)(n.code,{children:"NotAuthenticated"}),". A result of ",(0,s.jsx)(n.code,{children:"NotAuthenticated"})," typically means that the JWT supplied has expired, and that the transaction should be restarted with a fresh JWT. The SDK will then terminate."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Try Another Card"})}),"\n",(0,s.jsxs)(n.p,{children:["In some cases the SDK will determine that the transaction cannot be completed with the current card/device, in this case it will return a ",(0,s.jsx)(n.code,{children:"TryAnotherCard"})," result, and the mobile app should instruct the user to attempt the transaction with a different card. From the perspective of the SDK, this will be a new transaction."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Try Again Flow"})}),"\n",(0,s.jsxs)(n.p,{children:["In some unusual cases, the SDK will require the user to present the same card/device again, in order to complete the transaction. In these cases, the SDK will retain control, but will require the mobile application to communicate instructions to the user via ui messages during the transaction. These instructions will either be to tap the same card/device again ( ",(0,s.jsx)(n.code,{children:"TryAgain"})," ), or to first consult their device for instructions, then tap the device again ( ",(0,s.jsx)(n.code,{children:"SeePhoneForInstructions_ThenTapAgain"})," ). It is only when the transaction has been finally concluded that the SDK will communicate a final transaction result as per normal, then terminate."]}),"\n",(0,s.jsx)(n.h2,{id:"9-conclusion",children:"9. Conclusion"}),"\n",(0,s.jsx)(n.p,{children:"That concludes the guide to integrate the Halo.SDK into your application. For any questions, please do not hesitate to reach out to the Halo Dot Team."}),"\n",(0,s.jsxs)(n.p,{children:["Not what you were looking for? If you are looking for the Intent Integration guide, it is over ",(0,s.jsx)(n.a,{href:"/docs/documentations/sdk/halo-system-baseline",children:"here"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);